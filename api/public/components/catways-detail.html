<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau de Bord</title>
    <link rel="stylesheet" href="/stylesheets/styles.css">
</head>
<body>
    <div><a href="/catways/list"><button>Retour sur la liste des catways</button></a></div>
    <h1>üö§ D√©tails du Catway </h1> 

    <div id="catwayDetails">
        <p>Chargement des d√©tails...</p>
    </div>

    <div><a href="/"><button class="btn-deconnexion">Se d√©connecter</button></a></div>

    <script>
        async function fetchCatwayDetails() {
            // R√©cup√©rer l'ID depuis l'URL
            const catwayId = window.location.pathname.split("/").pop().trim();

            console.log("üìå ID r√©cup√©r√© :", catwayId); // ‚úÖ V√©rification ID r√©cup√©r√©

            if (!catwayId || catwayId.length < 24) { // V√©rification longueur ID
                document.getElementById("catwayDetails").innerHTML = "<p>‚ùå ID Catway invalide.</p>";
                return;
            }

            try {
                const response = await fetch(`/catways/${catwayId}`, {
                    method: "GET",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": "Bearer " + localStorage.getItem("token")
                    }
                });

                console.log("üì° Requ√™te envoy√©e √† :", `/catways/${catwayId}`); // ‚úÖ V√©rifier URL API

                const catway = await response.json();
                const detailsDiv = document.getElementById("catwayDetails");

                if (response.ok) {
                    detailsDiv.innerHTML = `
                        <h2>Catway ID: ${catway._id}</h2>
                        <p><strong>Pont:</strong> #${catway.catwayNumber}</p>
                        <p><strong>Type:</strong> ${catway.catwayType}</p>
                        <p><strong>√âtat:</strong> ${catway.catwayState}</p>
                    `;
                } else {
                    console.error("‚ùå Erreur API :", catway); // ‚úÖ Afficher erreur renvoy√©e par l'API
                    detailsDiv.innerHTML = `<p>‚ùå Erreur : ${catway.error || "Impossible de r√©cup√©rer les d√©tails."}</p>`;
                }

            } catch (error) {
                console.error("‚ùå Erreur inattendue :", error); // ‚úÖ V√©rifier erreur JavaScript
                document.getElementById("catwayDetails").innerHTML = `<p>‚ùå Erreur inattendue : ${error.message}</p>`;
            }
        }


        function logout() {
            localStorage.removeItem("token");
            window.location.href = "/";
        }

        // Charger les d√©tails au chargement de la page
        document.addEventListener("DOMContentLoaded", fetchCatwayDetails);
    </script>
</body>
</html>

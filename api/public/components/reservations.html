<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau de bord</title>
    <link rel="stylesheet" href="/stylesheets/styles.css">
</head>
<body>
    <div><a href="/dashboard"><button>Retour sur le tableau de bord principal</button></a></div>
    <h1>üìÜ Liste des R√©servations</h1>

    <div id="reservationList">
        <p>Chargement des r√©servations...</p>
    </div>

    <button class="btn-deconnexion"><a href="/">Se d√©connecter</a></button>

    <script>
        async function fetchReservations() {
            try {
                const response = await fetch('/reservations', {
                    method: "GET",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": "Bearer " + localStorage.getItem("token")
                    }
                });

                const reservations = await response.json();
                const reservationList = document.getElementById("reservationList");
                reservationList.innerHTML = ""; 

                if (response.ok) {
                    reservations.forEach(reservation => {
                        // Cr√©ation d'un conteneur div pour chaque r√©servation
                        const reservationDiv = document.createElement("div");
                        reservationDiv.classList.add("reservation-item");

                        // Titre avec l'ID de la r√©servation
                        const title = document.createElement("h2");
                        title.textContent = `R√©servation ID: ${reservation._id}`;

                        // Paragraphe avec les d√©tails de la r√©servation
                        const details = document.createElement("p");
                        details.innerHTML = ` <p><strong>Catway ID:</strong> ${reservation.catwayId ? reservation.catwayId._id || reservation.catwayId : "Non d√©fini"} </p> 
                                              <p><strong>Check-in:</strong> ${new Date(reservation.checkIn).toLocaleDateString()} </p>
                                              <p><strong>Check-out:</strong> ${new Date(reservation.checkOut).toLocaleDateString()} </p>`;

                        // Bouton "Voir d√©tails" qui redirige vers /details/{id}
                        const detailsButton = document.createElement("button");
                        detailsButton.textContent = "Voir d√©tails";
                        detailsButton.onclick = function() {
                            window.location.href = `/reservations/details/${reservation._id}`;
                        };

                        // Ajouter les √©l√©ments cr√©√©s dans la div
                        reservationDiv.appendChild(title);
                        reservationDiv.appendChild(details);
                        reservationDiv.appendChild(detailsButton);

                        // Ajouter la div au conteneur principal
                        reservationList.appendChild(reservationDiv);
                    });
                } else {
                    reservationList.innerHTML = `<p>‚ùå Erreur : ${reservations.error || "Impossible de charger les r√©servations"}</p>`;
                }

            } catch (error) {
                document.getElementById("reservationList").innerHTML = `<p>‚ùå Erreur inattendue : ${error.message}</p>`;
            }
        }

        // Fonction pour d√©connecter l'utilisateur
        function logout() {
            localStorage.removeItem("token");
            window.location.href = "/";
        }

        // Charger les r√©servations au chargement de la page
        document.addEventListener("DOMContentLoaded", fetchReservations);
    </script>


</body>
</html>
